<main class="main-container">
    @if (toDelete() !== null && !loading().deleting.has(toDelete()!.id)) {
        <div class="delete-modal-container">
            <div class="delete-modal">
                <h3>
                    {{
                        "warning.delete_product"
                            | translate
                                : {
                                      value: toDelete()?.name,
                                  }
                    }}
                </h3>
                <div class="delete-modal-actions">
                    <app-button
                        [color]="'secondary'"
                        [label]="'cancel.label' | translate"
                        (afterClick)="onCancelDelete()"
                    ></app-button>
                    <app-button
                        [color]="'primary'"
                        [label]="'confirm.label' | translate"
                        (afterClick)="onConfirmDelete()"
                    ></app-button>
                </div>
            </div>
        </div>
    }

    <div class="table-controls">
        <app-search-field (searchValue)="onSearch($event)"></app-search-field>
        <a class="btn btn-primary" routerLink="/products/details">
            {{ "add.label" | translate }}</a
        >
    </div>
    <div class="table-container">
        <table>
            <colgroup>
                <col span="5" />
                <col style="width: 50px" />
            </colgroup>
            <thead>
                <tr>
                    <th scope="col">{{ "logo.label" | translate }}</th>
                    <th scope="col">{{ "product.name" | translate }}</th>
                    <th scope="col">{{ "description.label" | translate }}</th>
                    <th scope="col">{{ "release.date" | translate }}</th>
                    <th scope="col">{{ "revision.date" | translate }}</th>
                    <th scope="col"></th>
                </tr>
            </thead>

            <tbody>
                @if (loading().fetching) {
                    <tr>
                        <td colspan="6">
                            <div class="loading-bar"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <div class="loading-bar"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="6">
                            <div class="loading-bar"></div>
                        </td>
                    </tr>
                } @else {
                    @for (data of datasource(); track data.id) {
                        <tr>
                            <td class="logo-cell">
                                <img [src]="data.logo" [alt]="data.name" />
                            </td>
                            <td>
                                <p>{{ data.name }}</p>
                            </td>
                            <td>
                                <p>{{ data.description }}</p>
                            </td>
                            <td>
                                <p>{{ data.date_release }}</p>
                            </td>

                            <td>
                                <p>{{ data.date_revision }}</p>
                            </td>
                            <td class="actions-column">
                                @if (loading().deleting.has(data.id)) {
                                    <div class="spinner"></div>
                                } @else {
                                    <app-item-menu
                                        [id]="data.id"
                                        (deleteId)="onDelete($event)"
                                    ></app-item-menu>
                                }
                            </td>
                        </tr>
                    } @empty {
                        <tr>
                            <td colspan="6">
                                <p class="no-results">
                                    {{ "results.no_results" | translate }}
                                </p>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>

        <!-- Contenedor para la paginaciÃ³n y el resumen de resultados -->
        <div class="footer-container">
            <div>
                {{ datasource().length }} {{ "results.label" | translate }}
            </div>
            <div class="paginator">
                <button
                    [disabled]="
                        loading().fetching ||
                        !pageControl().value ||
                        pageControl().value! <= 1
                    "
                    (click)="onPreviousPage()"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                    >
                        <g fill="none" fill-rule="evenodd">
                            <path
                                d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                            />
                            <path
                                fill="currentColor"
                                d="M7.94 13.06a1.5 1.5 0 0 1 0-2.12l5.656-5.658a1.5 1.5 0 1 1 2.121 2.122L11.122 12l4.596 4.596a1.5 1.5 0 1 1-2.12 2.122l-5.66-5.658Z"
                            />
                        </g>
                    </svg>
                </button>
                <input
                    type="text"
                    name="page"
                    id="page"
                    [formControl]="pageControl()"
                />
                <button
                    [disabled]="
                        loading().fetching ||
                        !pageControl().value ||
                        pageControl().value! >= pages()
                    "
                    (click)="onNextPage()"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                    >
                        <g fill="none" fill-rule="evenodd">
                            <path
                                d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"
                            />
                            <path
                                fill="currentColor"
                                d="M16.06 10.94a1.5 1.5 0 0 1 0 2.12l-5.656 5.658a1.5 1.5 0 1 1-2.121-2.122L12.879 12L8.283 7.404a1.5 1.5 0 0 1 2.12-2.122l5.658 5.657Z"
                            />
                        </g>
                    </svg>
                </button>
            </div>
            <div>
                <span> {{ "show_of_total.label" | translate }} </span>
                <div class="footer-controls">
                    <select (change)="onPageSizeChange($event)">
                        <option>5</option>
                        <option>10</option>
                        <option>20</option>
                    </select>
                </div>
                <span>
                    {{
                        "show_of_total.of"
                            | translate: { value: products().length }
                    }}
                </span>
            </div>
        </div>
    </div>
</main>

<app-toast></app-toast>
